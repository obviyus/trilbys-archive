---
/**
 * Stats Page - Fun statistics about Yahtzee's transcripts
 * Parchment aesthetic matching the main site
 */
import stats from "../data/stats.json";

function formatDuration(seconds: number): string {
  const hours = Math.floor(seconds / 3600);
  const mins = Math.floor((seconds % 3600) / 60);
  if (hours > 0) {
    return `${hours}h ${mins}m`;
  }
  return `${mins}m`;
}

function formatNumber(n: number): string {
  if (n >= 1000000) {
    return `${(n / 1000000).toFixed(1)}M`;
  }
  if (n >= 1000) {
    return `${(n / 1000).toFixed(1)}K`;
  }
  return n.toLocaleString();
}

const totalHours = Math.round(stats.totalDurationSeconds / 3600);
const avgMins = Math.round(stats.avgDurationSeconds / 60);

// Get top 5 profanity
const topProfanity = stats.profanityStats.slice(0, 8);

// Calculate total profanity
const totalProfanity = stats.profanityStats.reduce((sum, p) => sum + p.count, 0);

// Chart data preparation
const yearlyStats = (stats as any).yearlyStats || [];
const hasYearlyData = yearlyStats.length > 0;

// SVG chart dimensions
const chartWidth = 700;
const chartHeight = 280;
const padding = { top: 30, right: 60, bottom: 40, left: 60 };
const plotWidth = chartWidth - padding.left - padding.right;
const plotHeight = chartHeight - padding.top - padding.bottom;

// Compute chart scales if we have data
let wordsPoints: string = "";
let wpmPoints: string = "";
let yearLabels: { x: number; year: number }[] = [];
let wordsYLabels: { y: number; value: number }[] = [];
let wpmYLabels: { y: number; value: number }[] = [];

if (hasYearlyData) {
  const years = yearlyStats.map((y: any) => y.year);
  const minYear = Math.min(...years);
  const maxYear = Math.max(...years);

  const avgWords = yearlyStats.map((y: any) => y.avgWords);
  const minWords = Math.min(...avgWords) * 0.9;
  const maxWords = Math.max(...avgWords) * 1.1;

  const avgWpm = yearlyStats.map((y: any) => y.avgWordsPerMinute);
  const minWpm = Math.min(...avgWpm) * 0.9;
  const maxWpm = Math.max(...avgWpm) * 1.1;

  // Generate points for polylines
  const wordsPointsArr: string[] = [];
  const wpmPointsArr: string[] = [];

  yearlyStats.forEach((y: any, i: number) => {
    const x = padding.left + (plotWidth * (y.year - minYear)) / (maxYear - minYear || 1);
    const wordsY = padding.top + plotHeight - (plotHeight * (y.avgWords - minWords)) / (maxWords - minWords || 1);
    const wpmY = padding.top + plotHeight - (plotHeight * (y.avgWordsPerMinute - minWpm)) / (maxWpm - minWpm || 1);

    wordsPointsArr.push(`${x},${wordsY}`);
    wpmPointsArr.push(`${x},${wpmY}`);
  });

  wordsPoints = wordsPointsArr.join(" ");
  wpmPoints = wpmPointsArr.join(" ");

  // Year labels (show every 2-3 years)
  const step = Math.ceil((maxYear - minYear) / 8);
  for (let year = minYear; year <= maxYear; year += step) {
    const x = padding.left + (plotWidth * (year - minYear)) / (maxYear - minYear || 1);
    yearLabels.push({ x, year });
  }
  // Always include last year
  if (yearLabels[yearLabels.length - 1]?.year !== maxYear) {
    const x = padding.left + plotWidth;
    yearLabels.push({ x, year: maxYear });
  }

  // Y-axis labels for words (left)
  const wordsStep = Math.ceil((maxWords - minWords) / 4 / 50) * 50;
  for (let v = Math.ceil(minWords / 50) * 50; v <= maxWords; v += wordsStep) {
    const y = padding.top + plotHeight - (plotHeight * (v - minWords)) / (maxWords - minWords || 1);
    wordsYLabels.push({ y, value: v });
  }

  // Y-axis labels for WPM (right)
  const wpmStep = Math.ceil((maxWpm - minWpm) / 4 / 5) * 5;
  for (let v = Math.ceil(minWpm / 5) * 5; v <= maxWpm; v += wpmStep) {
    const y = padding.top + plotHeight - (plotHeight * (v - minWpm)) / (maxWpm - minWpm || 1);
    wpmYLabels.push({ y, value: v });
  }
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Fun statistics from every Zero Punctuation and Fully Ramblomatic video transcript"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Statistics — Trilby's Archive" />
    <meta property="og:description" content="Fun statistics from every Zero Punctuation and Fully Ramblomatic video transcript" />
    <meta property="og:image" content="https://trilbys-archive.pages.dev/preview.jpg" />
    <meta property="og:url" content="https://trilbys-archive.pages.dev/stats" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Statistics — Trilby's Archive" />
    <meta name="twitter:description" content="Fun statistics from every Zero Punctuation and Fully Ramblomatic video transcript" />
    <meta name="twitter:image" content="https://trilbys-archive.pages.dev/preview.jpg" />
    <title>Statistics — Trilby's Archive</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Special+Elite&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --zp-yellow: #f5c518;
        --zp-gold: #e5a500;
        --parchment: #faf6e9;
        --parchment-dark: #f0e9d2;
        --ink: #1a1612;
        --ink-light: #3d352d;
        --burgundy: #722f37;
      }

      * {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        font-family: "Libre Baskerville", Georgia, serif;
        background: var(--parchment);
        color: var(--ink);
        min-height: 100vh;
        line-height: 1.8;
      }

      .page-border {
        position: fixed;
        inset: 8px;
        border: 3px double var(--zp-gold);
        pointer-events: none;
        z-index: 100;
      }

      .container {
        max-width: 850px;
        margin: 0 auto;
        padding: 3rem 2rem 4rem;
      }

      /* Header */
      header {
        text-align: center;
        padding-bottom: 2rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid var(--ink);
        position: relative;
      }

      header::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--ink);
      }

      .back-link {
        font-family: "Special Elite", monospace;
        font-size: 0.75rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--burgundy);
        text-decoration: none;
        display: inline-block;
        margin-bottom: 1.5rem;
        border-bottom: 1px dotted var(--burgundy);
        transition: border-color 0.2s;
      }

      .back-link:hover {
        border-bottom-style: solid;
      }

      .series-badge {
        font-family: "Special Elite", monospace;
        font-size: 0.65rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        background: var(--zp-yellow);
        color: var(--ink);
        padding: 0.3em 0.8em;
        display: inline-block;
        margin-bottom: 1rem;
      }

      h1 {
        font-family: "Playfair Display", serif;
        font-size: clamp(2.2rem, 7vw, 3.5rem);
        font-weight: 700;
        margin: 0;
        line-height: 1.1;
        color: var(--ink);
      }

      .tagline {
        font-family: "Libre Baskerville", serif;
        font-style: italic;
        font-size: 1rem;
        color: var(--ink-light);
        margin-top: 1rem;
      }

      /* Section Headers */
      .section-header {
        font-family: "Special Elite", monospace;
        font-size: 0.7rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--ink-light);
        text-align: center;
        margin: 3rem 0 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .section-header::before,
      .section-header::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--zp-gold);
      }

      /* Big Stats Row */
      .big-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0;
        margin: 2rem 0;
        border: 2px solid var(--ink);
        box-shadow: 4px 4px 0 var(--ink);
        background: var(--parchment);
      }

      .big-stat {
        text-align: center;
        padding: 1.5rem 0.75rem;
        position: relative;
        background: linear-gradient(
          180deg,
          var(--parchment-dark) 0%,
          var(--parchment) 100%
        );
      }

      .big-stat:not(:last-child)::after {
        content: "";
        position: absolute;
        right: 0;
        top: 15%;
        height: 70%;
        width: 1px;
        background: var(--ink);
      }

      .big-stat-number {
        font-family: "Playfair Display", serif;
        font-size: clamp(1.8rem, 5vw, 2.8rem);
        font-weight: 700;
        color: var(--ink);
        line-height: 1;
      }

      .big-stat-number.highlight::after {
        content: "";
        display: block;
        height: 3px;
        background: var(--zp-yellow);
        margin: 4px auto 0;
        width: 60%;
      }

      .big-stat-label {
        font-family: "Special Elite", monospace;
        font-size: 0.55rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--ink-light);
        margin-top: 0.5rem;
      }

      /* Series Breakdown */
      .series-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin: 1.5rem 0;
      }

      .series-card {
        border: 2px solid var(--ink);
        box-shadow: 3px 3px 0 var(--ink);
        background: var(--parchment);
      }

      .series-card-header {
        background: var(--parchment-dark);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--ink);
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 1.1rem;
      }

      .series-card-body {
        padding: 1rem;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        text-align: center;
      }

      .series-stat-num {
        font-family: "Playfair Display", serif;
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--burgundy);
      }

      .series-stat-label {
        font-family: "Special Elite", monospace;
        font-size: 0.55rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--ink-light);
      }

      /* Records */
      .records-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .record-card {
        border: 2px solid var(--ink);
        box-shadow: 3px 3px 0 var(--ink);
        background: var(--parchment);
        padding: 1rem 1.25rem;
      }

      .record-label {
        font-family: "Special Elite", monospace;
        font-size: 0.6rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--ink-light);
        margin-bottom: 0.25rem;
      }

      .record-title {
        font-family: "Playfair Display", serif;
        font-size: 1rem;
        font-weight: 700;
        color: var(--ink);
        margin-bottom: 0.25rem;
        line-height: 1.3;
      }

      .record-value {
        font-family: "Libre Baskerville", serif;
        font-size: 0.85rem;
        color: var(--burgundy);
        font-style: italic;
      }

      .record-title a {
        color: inherit;
        text-decoration: none;
        border-bottom: 1px dotted var(--burgundy);
        transition: border-color 0.15s;
      }

      .record-title a:hover {
        border-bottom-style: solid;
        color: var(--burgundy);
      }

      /* Profanity Chart */
      .profanity-section {
        border: 2px solid var(--ink);
        box-shadow: 4px 4px 0 var(--ink);
        background: var(--parchment);
        margin: 1.5rem 0;
      }

      .profanity-header {
        background: var(--parchment-dark);
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--ink);
        display: flex;
        justify-content: space-between;
        align-items: baseline;
      }

      .profanity-title {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 1.2rem;
      }

      .profanity-total {
        font-family: "Special Elite", monospace;
        font-size: 0.7rem;
        color: var(--ink-light);
      }

      .profanity-list {
        padding: 1rem 1.25rem;
      }

      .profanity-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 0;
        border-bottom: 1px dotted var(--parchment-dark);
      }

      .profanity-row:last-child {
        border-bottom: none;
      }

      .profanity-word {
        font-family: "Special Elite", monospace;
        font-size: 0.85rem;
        width: 80px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .profanity-bar-container {
        flex: 1;
        height: 20px;
        background: var(--parchment-dark);
        border: 1px solid var(--ink);
        position: relative;
      }

      .profanity-bar {
        height: 100%;
        background: var(--burgundy);
        transition: width 0.5s ease;
      }

      .profanity-count {
        font-family: "Playfair Display", serif;
        font-size: 0.9rem;
        font-weight: 700;
        width: 60px;
        text-align: right;
      }

      /* Fun Facts */
      .fun-facts {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .fun-fact {
        border: 2px solid var(--ink);
        box-shadow: 3px 3px 0 var(--ink);
        background: var(--parchment);
        padding: 1.25rem;
        text-align: center;
      }

      .fun-fact-value {
        font-family: "Playfair Display", serif;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--burgundy);
        margin-bottom: 0.5rem;
        line-height: 1.3;
      }

      .fun-fact-label {
        font-family: "Special Elite", monospace;
        font-size: 0.6rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--ink-light);
      }

      /* Top Words */
      .words-cloud {
        border: 2px solid var(--ink);
        box-shadow: 4px 4px 0 var(--ink);
        background: var(--parchment);
        padding: 2rem 1.5rem;
        margin: 1.5rem 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 0.4rem 0.8rem;
        min-height: 280px;
      }

      .word-item {
        display: inline-flex;
        align-items: baseline;
        font-family: "Libre Baskerville", serif;
        transition: all 0.2s ease;
        cursor: default;
        position: relative;
        padding: 0.2rem 0.4rem;
        border-radius: 2px;
      }

      .word-item:hover {
        background: var(--parchment-dark);
        transform: scale(1.05);
      }

      .word-item .word-count {
        font-family: "Special Elite", monospace;
        font-size: 0.55em;
        color: var(--burgundy);
        margin-left: 0.3em;
        opacity: 0;
        transition: opacity 0.2s;
        vertical-align: super;
      }

      .word-item:hover .word-count {
        opacity: 1;
      }

      /* Dynamic sizing via inline styles, but keep weight classes */
      .word-item.weight-1 { font-weight: 700; color: var(--ink); }
      .word-item.weight-2 { font-weight: 700; color: var(--ink); }
      .word-item.weight-3 { font-weight: 600; color: var(--ink); }
      .word-item.weight-4 { font-weight: 400; color: var(--ink); }
      .word-item.weight-5 { font-weight: 400; color: var(--ink-light); }

      /* Subtle rotation for visual interest */
      .word-item:nth-child(5n+1) { transform: rotate(-2deg); }
      .word-item:nth-child(7n+3) { transform: rotate(1.5deg); }
      .word-item:nth-child(11n+2) { transform: rotate(-1deg); }
      .word-item:hover { transform: rotate(0deg) scale(1.05); }

      /* Games */
      .games-list {
        border: 2px solid var(--ink);
        box-shadow: 4px 4px 0 var(--ink);
        background: var(--parchment);
        margin: 1.5rem 0;
      }

      .games-header {
        background: var(--parchment-dark);
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--ink);
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 1.1rem;
      }

      .games-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        padding: 0;
      }

      .game-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid var(--parchment-dark);
      }

      .game-item:nth-child(odd) {
        border-right: 1px solid var(--parchment-dark);
      }

      .game-name {
        font-family: "Libre Baskerville", serif;
        font-size: 0.9rem;
        text-transform: capitalize;
      }

      .game-count {
        font-family: "Special Elite", monospace;
        font-size: 0.75rem;
        color: var(--burgundy);
      }

      /* Footer */
      footer {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid var(--zp-gold);
        text-align: center;
        font-size: 0.85rem;
        color: var(--ink-light);
      }

      footer p {
        margin: 0.5rem 0;
      }

      footer a {
        color: var(--burgundy);
        text-decoration: none;
        border-bottom: 1px dotted var(--burgundy);
      }

      footer a:hover {
        border-bottom-style: solid;
      }

      .colophon {
        font-style: italic;
        font-size: 0.75rem;
        margin-top: 1.5rem;
        opacity: 0.7;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .big-stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .big-stat:nth-child(2)::after {
          display: none;
        }

        .big-stat:nth-child(1),
        .big-stat:nth-child(2) {
          border-bottom: 1px solid var(--ink);
        }

        .series-grid,
        .records-grid,
        .fun-facts {
          grid-template-columns: 1fr;
        }

        .games-grid {
          grid-template-columns: 1fr;
        }

        .game-item:nth-child(odd) {
          border-right: none;
        }
      }

      @media (max-width: 640px) {
        .container {
          padding: 2rem 1.5rem;
        }

        .page-border {
          display: none;
        }

        .profanity-word {
          width: 60px;
          font-size: 0.75rem;
        }

        .profanity-count {
          width: 50px;
          font-size: 0.8rem;
        }
      }

      /* Charts */
      .chart-section {
        border: 2px solid var(--ink);
        box-shadow: 4px 4px 0 var(--ink);
        background: var(--parchment);
        margin: 1.5rem 0;
      }

      .chart-header {
        background: var(--parchment-dark);
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--ink);
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .chart-title {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 1.2rem;
      }

      .chart-legend {
        display: flex;
        gap: 1.5rem;
        font-family: "Special Elite", monospace;
        font-size: 0.65rem;
        letter-spacing: 0.05em;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .legend-line {
        width: 20px;
        height: 3px;
      }

      .legend-line.words {
        background: var(--burgundy);
      }

      .legend-line.wpm {
        background: var(--zp-gold);
      }

      .chart-body {
        padding: 1.5rem;
        overflow-x: auto;
      }

      .chart-svg {
        display: block;
        margin: 0 auto;
        max-width: 100%;
        height: auto;
      }

      .chart-axis-label {
        font-family: "Special Elite", monospace;
        font-size: 10px;
        fill: var(--ink-light);
      }

      .chart-axis-label.left {
        fill: var(--burgundy);
      }

      .chart-axis-label.right {
        fill: var(--zp-gold);
      }

      .chart-year-label {
        font-family: "Special Elite", monospace;
        font-size: 11px;
        fill: var(--ink-light);
      }

      .chart-grid-line {
        stroke: var(--parchment-dark);
        stroke-width: 1;
      }

      .chart-line {
        fill: none;
        stroke-width: 2.5;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .chart-line.words {
        stroke: var(--burgundy);
      }

      .chart-line.wpm {
        stroke: var(--zp-gold);
      }

      .chart-dot {
        r: 4;
        transition: r 0.15s ease;
      }

      .chart-dot.words {
        fill: var(--burgundy);
      }

      .chart-dot.wpm {
        fill: var(--zp-gold);
      }

      .chart-dot:hover {
        r: 6;
      }

      .chart-empty {
        padding: 3rem;
        text-align: center;
        font-family: "Libre Baskerville", serif;
        font-style: italic;
        color: var(--ink-light);
      }

      /* Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      header { animation: fadeIn 0.5s ease-out; }
      .big-stats { animation: fadeIn 0.5s ease-out 0.1s backwards; }
      .chart-section { animation: fadeIn 0.5s ease-out 0.12s backwards; }
      .series-grid { animation: fadeIn 0.5s ease-out 0.15s backwards; }
      .records-grid { animation: fadeIn 0.5s ease-out 0.2s backwards; }
      .profanity-section { animation: fadeIn 0.5s ease-out 0.25s backwards; }
      .fun-facts { animation: fadeIn 0.5s ease-out 0.3s backwards; }
      .words-cloud { animation: fadeIn 0.5s ease-out 0.35s backwards; }
      .games-list { animation: fadeIn 0.5s ease-out 0.4s backwards; }
    </style>
  </head>

  <body>
    <div class="page-border"></div>

    <div class="container">
      <!-- Header -->
      <header>
        <a href="/" class="back-link">← Return to Archives</a>
        <div class="series-badge">Data Dive</div>
        <h1>By the Numbers</h1>
        <p class="tagline">Statistical analysis of {stats.totalVideos} videos worth of gaming critique</p>
      </header>

      <!-- Big Stats -->
      <div class="big-stats">
        <div class="big-stat">
          <div class="big-stat-number highlight">{stats.totalVideos}</div>
          <div class="big-stat-label">Videos</div>
        </div>
        <div class="big-stat">
          <div class="big-stat-number">{formatNumber(stats.totalWords)}</div>
          <div class="big-stat-label">Words</div>
        </div>
        <div class="big-stat">
          <div class="big-stat-number">{totalHours}</div>
          <div class="big-stat-label">Hours</div>
        </div>
        <div class="big-stat">
          <div class="big-stat-number">{stats.avgWordsPerMinute}</div>
          <div class="big-stat-label">Words/Min</div>
        </div>
      </div>

      <!-- Trends Over Time -->
      {hasYearlyData && (
        <>
          <div class="section-header">Trends Over Time</div>
          <div class="chart-section">
            <div class="chart-header">
              <span class="chart-title">Average Words & Speaking Rate by Year</span>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="legend-line words"></span>
                  <span>Avg Words/Video</span>
                </div>
                <div class="legend-item">
                  <span class="legend-line wpm"></span>
                  <span>Words/Minute</span>
                </div>
              </div>
            </div>
            <div class="chart-body">
              <svg
                class="chart-svg"
                viewBox={`0 0 ${chartWidth} ${chartHeight}`}
                preserveAspectRatio="xMidYMid meet"
              >
                {/* Grid lines */}
                {wordsYLabels.map((label) => (
                  <line
                    class="chart-grid-line"
                    x1={padding.left}
                    y1={label.y}
                    x2={chartWidth - padding.right}
                    y2={label.y}
                  />
                ))}

                {/* Left Y-axis labels (Words) */}
                {wordsYLabels.map((label) => (
                  <text
                    class="chart-axis-label left"
                    x={padding.left - 8}
                    y={label.y + 3}
                    text-anchor="end"
                  >
                    {label.value}
                  </text>
                ))}

                {/* Right Y-axis labels (WPM) */}
                {wpmYLabels.map((label) => (
                  <text
                    class="chart-axis-label right"
                    x={chartWidth - padding.right + 8}
                    y={label.y + 3}
                    text-anchor="start"
                  >
                    {label.value}
                  </text>
                ))}

                {/* X-axis labels (Years) */}
                {yearLabels.map((label) => (
                  <text
                    class="chart-year-label"
                    x={label.x}
                    y={chartHeight - padding.bottom + 20}
                    text-anchor="middle"
                  >
                    {label.year}
                  </text>
                ))}

                {/* Words line */}
                <polyline class="chart-line words" points={wordsPoints} />

                {/* WPM line */}
                <polyline class="chart-line wpm" points={wpmPoints} />

                {/* Data points for words */}
                {yearlyStats.map((y: any) => {
                  const years = yearlyStats.map((d: any) => d.year);
                  const minYear = Math.min(...years);
                  const maxYear = Math.max(...years);
                  const avgWords = yearlyStats.map((d: any) => d.avgWords);
                  const minWords = Math.min(...avgWords) * 0.9;
                  const maxWords = Math.max(...avgWords) * 1.1;

                  const x = padding.left + (plotWidth * (y.year - minYear)) / (maxYear - minYear || 1);
                  const cy = padding.top + plotHeight - (plotHeight * (y.avgWords - minWords)) / (maxWords - minWords || 1);

                  return <circle class="chart-dot words" cx={x} cy={cy}><title>{y.year}: {y.avgWords} avg words</title></circle>;
                })}

                {/* Data points for WPM */}
                {yearlyStats.map((y: any) => {
                  const years = yearlyStats.map((d: any) => d.year);
                  const minYear = Math.min(...years);
                  const maxYear = Math.max(...years);
                  const avgWpm = yearlyStats.map((d: any) => d.avgWordsPerMinute);
                  const minWpm = Math.min(...avgWpm) * 0.9;
                  const maxWpm = Math.max(...avgWpm) * 1.1;

                  const x = padding.left + (plotWidth * (y.year - minYear)) / (maxYear - minYear || 1);
                  const cy = padding.top + plotHeight - (plotHeight * (y.avgWordsPerMinute - minWpm)) / (maxWpm - minWpm || 1);

                  return <circle class="chart-dot wpm" cx={x} cy={cy}><title>{y.year}: {y.avgWordsPerMinute} words/min</title></circle>;
                })}
              </svg>
            </div>
          </div>
        </>
      )}

      <!-- Series Breakdown -->
      <div class="section-header">Series Breakdown</div>
      <div class="series-grid">
        {stats.seriesBreakdown.map((series) => (
          <div class="series-card">
            <div class="series-card-header">{series.name}</div>
            <div class="series-card-body">
              <div>
                <div class="series-stat-num">{series.count}</div>
                <div class="series-stat-label">Videos</div>
              </div>
              <div>
                <div class="series-stat-num">{formatNumber(series.avgWordsPerVideo)}</div>
                <div class="series-stat-label">Avg Words</div>
              </div>
              <div>
                <div class="series-stat-num">{series.wordsPerMinute}</div>
                <div class="series-stat-label">Words/Min</div>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Records -->
      <div class="section-header">Records & Extremes</div>
      <div class="records-grid">
        <div class="record-card">
          <div class="record-label">Longest Review</div>
          <div class="record-title">
            <a href={`/transcript/${stats.longestVideo.id}`}>{stats.longestVideo.title}</a>
          </div>
          <div class="record-value">{formatDuration(stats.longestVideo.duration)}</div>
        </div>
        <div class="record-card">
          <div class="record-label">Shortest Review</div>
          <div class="record-title">
            <a href={`/transcript/${stats.shortestVideo.id}`}>{stats.shortestVideo.title}</a>
          </div>
          <div class="record-value">{formatDuration(stats.shortestVideo.duration)}</div>
        </div>
        <div class="record-card">
          <div class="record-label">Most Words</div>
          <div class="record-title">
            <a href={`/transcript/${stats.mostWords.id}`}>{stats.mostWords.title}</a>
          </div>
          <div class="record-value">{stats.mostWords.wordCount.toLocaleString()} words</div>
        </div>
        <div class="record-card">
          <div class="record-label">Fastest Talker</div>
          <div class="record-title">
            <a href={`/transcript/${stats.mostVerbose.id}`}>{stats.mostVerbose.title}</a>
          </div>
          <div class="record-value">{stats.mostVerbose.wordsPerMinute} words/min</div>
        </div>
      </div>

      <!-- Profanity -->
      <div class="section-header">Colorful Language</div>
      <div class="profanity-section">
        <div class="profanity-header">
          <span class="profanity-title">Profanity Leaderboard</span>
          <span class="profanity-total">{totalProfanity.toLocaleString()} total expletives</span>
        </div>
        <div class="profanity-list">
          {topProfanity.map((p) => {
            const maxCount = topProfanity[0].count;
            const percentage = (p.count / maxCount) * 100;
            return (
              <div class="profanity-row">
                <span class="profanity-word">{p.word}</span>
                <div class="profanity-bar-container">
                  <div class="profanity-bar" style={`width: ${percentage}%`}></div>
                </div>
                <span class="profanity-count">{p.count.toLocaleString()}</span>
              </div>
            );
          })}
        </div>
      </div>

      <!-- Fun Facts -->
      <div class="section-header">Fun Comparisons</div>
      <div class="fun-facts">
        {stats.funFacts.map((fact) => (
          <div class="fun-fact">
            <div class="fun-fact-value">{fact.value}</div>
            <div class="fun-fact-label">{fact.label}</div>
          </div>
        ))}
      </div>

      <!-- Top Words -->
      <div class="section-header">Most Used Words</div>
      <div class="words-cloud">
        {(() => {
          const words = stats.topWords.slice(0, 30);
          const maxCount = words[0].count;
          const minCount = words[words.length - 1].count;
          const minSize = 0.85;
          const maxSize = 2.6;

          // Shuffle for cloud effect (seeded by word to keep consistent)
          const shuffled = [...words].sort((a, b) => {
            const hashA = a.word.charCodeAt(0) + a.word.charCodeAt(a.word.length - 1);
            const hashB = b.word.charCodeAt(0) + b.word.charCodeAt(b.word.length - 1);
            return hashA - hashB;
          });

          return shuffled.map((w) => {
            // Linear scaling for clearer frequency differences
            const normalized = (w.count - minCount) / (maxCount - minCount);
            const fontSize = minSize + normalized * (maxSize - minSize);

            // Weight class for font-weight and color
            let weightClass = "weight-5";
            if (normalized > 0.85) weightClass = "weight-1";
            else if (normalized > 0.65) weightClass = "weight-2";
            else if (normalized > 0.45) weightClass = "weight-3";
            else if (normalized > 0.25) weightClass = "weight-4";

            return (
              <span
                class={`word-item ${weightClass}`}
                style={`font-size: ${fontSize.toFixed(2)}rem`}
              >
                {w.word}
                <span class="word-count">{w.count.toLocaleString()}</span>
              </span>
            );
          });
        })()}
      </div>

      <!-- Top Games -->
      <div class="section-header">Most Mentioned Franchises</div>
      <div class="games-list">
        <div class="games-header">Games & Series Referenced</div>
        <div class="games-grid">
          {stats.topMentionedGames.slice(0, 16).map((g) => (
            <div class="game-item">
              <span class="game-name">{g.game}</span>
              <span class="game-count">{g.count} mentions</span>
            </div>
          ))}
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <p>
          <a href="/">Search the archives</a> · <a href="https://github.com/obviyus/trilbys-archive">View source</a>
        </p>
        <p class="colophon">
          Statistics computed from {stats.totalVideos} video transcripts spanning 17 years of gaming critique.
        </p>
      </footer>
    </div>
  </body>
</html>
